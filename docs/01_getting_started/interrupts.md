# Interrupts
## Generic Interrupt Controller
A Generic Interrupt Controller (GIC) takes interrupts from peripherals, prioritizes them, and delivers them to the appropriate processor core. The GIC is the standard interrupt controller for Arm Cortex-A and Arm Cortex-R profile processors.

### Interrupt types
The GIC can deal with four different types of interrupt sources:
- Shared Peripheral Interrupt (SPI). Peripheral interrupts that can be delivered to any connected core.

- Private Peripheral Interrupt (PPI). Peripheral interrupts that are private to one core. An example of a PPI is an interrupt from the Generic Timer.

- Software Generated Interrupt (SGI). SGIs are typically used for inter-processor communication and are generated by a write to an SGI register in the GIC.

- Locality-specific Peripheral Interrupt (LPI). LPIs were first introduced in GICv3 and have a very different programing model to the other three types of interrupt. 

### INTID 
Each interrupt source is identified by an ID number, which is referred to as an INTID

1. SGIs - [0 - 15]
2. PPIs - [16 - 31 && 1056 - 1119]
3. SPIs - [32 - 1019 && 4096 - 5119]
4. Special interrupt number (Used to signal special cases) - [1020 - 1023]
5. Reserved - [1024 - 8191]
6. LPIs - [8192 and greater]

### Signaling Interrupts 

1. Dedicated interrupt signal - interrupts are signaled from a peripheral to the interrupt controller using a dedicated hardware signal.

2. Message Signaled Interrupts (MSI) - interrupts are signaled by writing a specific data value to a register in interrupt controller.

**NOTE**: T_T Just realized that Raspberry Pi Zero 2 W doesn have a GIC but rather uses the broadcom interrupt controller. Will have this section here since I already wrote it.

## Interrupt Controller - Broadcom BCM2836/7 Interrupt Controller
### Local Interrupt Controller
The local interrupt controller is a CPU-local interrupt management unit present in the BCM2836/7 SoC. Unlike the main interrupt controller that handles global device interrupts, the local controller manages interrupts that are private to each CPU core.

It will be handling the following interrupts:
- Per-CPU timer interrupts
- Inter-Processor Interrupts (IPIs)
- Performance Monitoring Unit (PMU) interrupts
- Fast GPU interrupts (FIQ)
- Mailbox interrupts for CPU communication

#### Supported Interrupt Types:
- Per-CPU timer interrupts
  - CNTPSIRQ (0) - Physical Secure Timer
  - CNTPNSIRQ (1) - Physical Non-Secure Timer  
  - CNTHPIRQ (2) - Hypervisor Timer
  - CNTVIRQ (3) - Virtual Timer
- Inter-Processor Interrupts (IPIs)
  - MAILBOX0-3 (4-7) - CPU mailbox interrupts
- Performance Monitoring Unit (PMU) interrupts
  - PMU_FAST (9) - Performance monitoring events
- Fast GPU interrupts (FIQ)
  - GPU_FAST (8) - Fast interrupts from GPU

#### Key Registers:
- Timer Control (0x040 + cpu * 4): Per-CPU timer interrupt enable/disable
- IRQ Pending (0x060 + cpu * 4): Per-CPU pending interrupt status
- PMU Routing (0x010/0x014): PMU interrupt routing control

## Reference
- [ARM GIC Fundamentals](https://developer.arm.com/documentation/198123/0302/Arm-GIC-fundamentals)
- [Raspberry Pi BCM2826 Peripherals](https://datasheets.raspberrypi.com/bcm2836/bcm2836-peripherals.pdf)